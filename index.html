<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="icon" type="image/png" href="images/favicon-recycler.png">
    <title>GREEN BANK</title>
</head>
<!-- CODE CSS : -->
<style>
html, body{
    height: 100%;
    width: 100%;
}
body{
    background-image: url(images/bg3.jpg);
    font-family: Georgia, serif;
    background-size: cover;
    margin: 0;
    padding: 0;
    text-align: center;
    padding-bottom: 15%;
    margin-top: 1.5%;
    font-size: 1.2em;
}
.form{
    width: 50%;
    margin-left: 25%;
    border: 3px solid black;
    padding-bottom: 3%;
    
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    border-radius: 20px;
    background-color: #DCDEDE;
}
h2{
    color: black;
}
.bouton{
    width: 75%;
    height: 50px;
    background-color: #44850C;
    font-weight: bold;
    font-size: 20px;
}
.bouton:hover{
    transition: 0.75s;
    background-color: #7CEC68;
    height: 55px;
    width: 80%;
}
.selecteur{
    background-color: #8BA489;
    width: 50%;
    height: 40px;
    font-size: 1.05em;
    text-align: center;
    border: 2px solid;
    margin-bottom: 20px;
}
.text{
    font-weight: bold;
    padding-bottom: 5px;
}
.banque_populaire{
    margin-top: 1%;
}
.bulle{
    position: absolute;
    border-radius: 40%;
    width: 20%;
    height: 10%;
    background-color: #8BA489;
    right: 2%;
    top: 10%;
    font-family: fantasy;
}
.slogan{
    margin-top: 7%;
}
</style>
<!-- CODE HTML : -->
<body>

    <!-- Div qui servira pour le titre de la 2eme page (affichage du taux) : -->
    <div id="taux"></div>

    <div class="bulle"><div class="slogan">Roulez écolo, et faites baisser votre taux</div></div>

    <!-- Formulaire : -->
    <div class="form">
        <!-- Titre dans le formulaire -->
        <h2>SIMULATEUR D'EMPRUNT <br> POUR L'ACHAT D'UNE VOITURE</h2>
        <!-- Type de Véhicule : -->
        <div class="text">TYPE DE VEHICULE</div>
        <!-- Selecteur : -->
        <select id="type_vehicule" class="selecteur">
            <option value="Choisir_vehicule">Choisir un type de véhicule</option>
            <option value="Citadine">Citadine</option>
            <option value="Cabriolet">Cabriolet</option>
            <option value="Berline">Berline</option>
            <option value="SUV/4*4">SUV/4*4</option>
        </select>

        <!-- Energie : -->
        <div class="text">ENERGIE</div>
        <!-- Selecteur : -->
        <select id="type_energie" class="selecteur">
            <option value="Choisir_energie">Choisir un type d'énergie</option>
            <option value="Essence">Essence</option>
            <option value="Electrique">Electrique</option>
            <option value="Gaz">Gaz</option>
            <option value="Diesel">Diesel</option>
            <option value="Hybride">Hybride</option>
        </select>

        <!-- Kilométrage : -->
        <div class="text">KILOMETRAGE ANNUEL</div>
        <!-- <input type="number" id="nb_kilometre" placeholder="15000 (km)" min="0" class="selecteur">  -->
        <select id="kilometre" class="selecteur">
            <option value="Choisir_kilometre">Choisir le nombre de kilomètres</option>
            <option value="5">5-10K/km</option>
            <option value="10">10-15K/km</option>
            <option value="15">15-20K/km</option>
            <option value="20">20-25K/km</option>
            <option value="25">25-30K/km</option>
        </select>

        <!-- Année : -->
        <div class="text">ANNEE DU VEHICULE</div>
        <select id="annee" class="selecteur">
            <option value="Choisir_annee">Choisir le nombre d'années</option>
            <option value="1960">1960-1970</option>
            <option value="1970">1970-1980</option>
            <option value="1990">1990-2000</option>
            <option value="2000">2000-2010</option>
            <option value="2010">Après 2010</option>
        </select>
        <!-- Nombre de passagers : -->
        <div class="text">NOMBRE DE PASSAGERS</div>
        <select id="passagers" class="selecteur">
            <option value="Choisir_passagers">Choisir le nombre de passagers</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>

        <br> <br> <br>

        <!-- Bouton pour envoyer : -->
        <input type="submit" value="CALCULER" class="bouton" onclick="calculate()">
    </div>

    <img src="images/banque_populaire.png" class="banque_populaire" alt="Logo_Banque_Populaire" width="80px">
<!-- CODE JAVASCRIPT : -->
<script>
// Récupérer les informations et initialiser des variables :
const type_vehicule = document.getElementById("type_vehicule");
const type_energie = document.getElementById("type_energie");
const kilometre_value = document.getElementById("kilometre");
const annee_value = document.getElementById("annee");
const passagers_value = document.getElementById("passagers");
vehicule = "";
energie = "";
kilometre = "";
annee = "";
passagers = "";

// Je récupere les valeurs au change : 
type_vehicule.addEventListener("change", (event) => {
    vehicule = `${event.target.value}`;
});
type_energie.addEventListener("change", (event) => {
    energie = `${event.target.value}`;
});
kilometre_value.addEventListener("change", (event) => {
    kilometre = `${event.target.value}`;
});
annee_value.addEventListener("change", (event) => {
    annee = `${event.target.value}`;
});
passagers_value.addEventListener("change", (event) => {
    passagers = `${event.target.value}`;
});

// Calculer :
function calculate() {
    // Je vérifie si tous les champs sont bien remplis :
    if (vehicule == "" || energie == "" || kilometre == "" || annee == "" || passagers == "") {
        alert("Vous devez remplir tous les champs disponibles sans exceptions !");
        // J'arrete l'execution de la fonction :
        return None
    }

    // Je calcule la note avec chaque variable (et ses fonctions associées) :
    note = avoir_note_pour_type_vehicule(vehicule) + avoir_note_pour_type_energie(energie) + avoir_note_pour_kilometrage(kilometre) + avoir_note_pour_annee(annee);
    // Je calcule le taux d'emprunt avec la fonction associé
    taux = avoir_taux_emprunt(note, passagers);
    console.log(taux);
    // Je mets dans une div un nouveau titre :
    document.getElementById("taux").innerHTML = "<h1> TAUX D'EMPRUNT DE VOTRE VOITURE </h1>";
    // Je fais mon animation pour montrer le taux :
    animation(taux)
}

// Fonction de l'animation et de la deuxieme page :
function animation(taux) {
    valeur_afficher = 0
    interval = setInterval(function() {
        valeur_afficher+=0.01
        if (valeur_afficher >= taux) {
            // Correction finale pour s'assurer qu'il n'y a pas eu de mauvais arrondis
            valeur_afficher = taux
            document.querySelector(".form").innerHTML = "<p style='font-size: "+valeur_afficher*160+"%; color: green;'>" + Math.round(valeur_afficher*100)/100 + "% </p>";
            // Quand la valeur est égale au taux, j'arrete la boucle
            clearInterval(interval);
        }
        // A chaque boucle, j'actualise mon formulaire en mettant la valeur et en changeant la taille du texte par rapport à la valeur :
        document.querySelector(".form").innerHTML = "<p style='font-size: "+valeur_afficher*160+"%; color: green;'>" + Math.round(valeur_afficher*100)/100 + "% </p>";
    }, 10);
}
// Fonction pour avoir la note à partir du véhicule correpondant
function avoir_note_pour_type_vehicule(type_vehicule) {
    // Voici ma base de donnée sous forme de liste de liste
    vehicule_notes_list = [["Citadine", 8], ["Cabriolet", 6], ["Berline", 6.5], ["SUV/4*4", 4]];
    // Je fais ensuite une recherche dans la base en vérifiant si le véhicule est égale à l'un de ceux de la liste
    for (let x = 0; x < vehicule_notes_list.length; x++) {
        if (vehicule_notes_list[x][0] == type_vehicule) {
            // Je renvoye la bonne valeur
            return vehicule_notes_list[x][1];
        }
    }
}

// Fonction pour avoir la note à partir de l'énergie correpondant
function avoir_note_pour_type_energie(type_energie) {
    // Meme principe que la fonction au dessus : recherche dans la liste
    energie_notes_list = [["Essence", 5], ["Electrique", 9], ["Gaz", 6], ["Diesel", 4], ["Hybride", 7]];
    for (let x = 0; x < energie_notes_list.length; x++) {
        if (energie_notes_list[x][0] == type_energie) {
            return energie_notes_list[x][1];
        }
    }
}

// Fonction permettant d'avoir la note avec le nombre de kilometres pour un an
function avoir_note_pour_kilometrage(nb_kilometre) {
    kilometrage_notes_list = [[5, 9], [10, 7], [15, 5], [20, 3], [25, 1]];
    for (let x = 0; x < kilometrage_notes_list.length; x++) {
        if (kilometrage_notes_list[x][0] == nb_kilometre) {
            return kilometrage_notes_list[x][1];
        }
    }
}

// Fonction permettant d'avoir la note avec l'année de création du véhicule 
function avoir_note_pour_annee(nb_annee) {
    annees_notes_list = [[1960, 1], [1970, 2], [1990, 4], [2000, 5], [2010, 7]];
    for (let x = 0; x < annees_notes_list.length; x++) {
        if (annees_notes_list[x][0] == nb_annee) {
            return annees_notes_list[x][1];
        }
    }
}

// Fonction permettant d'avoir le taux d'emprunt à partir de la note et du nombre de passagers dans le véhicule
function avoir_taux_emprunt(note, passagers) {
    // Calcul du taux avec la note :
    if (note < 10) {
        taux_actuel = 3;
    }
    else if (note < 15) {
        taux_actuel = 2.74;
    }
    else if (note < 25) {
        taux_actuel = 2.52;
    }
    else if (note < 33) {
        taux_actuel = 2.10;
    }
    else if (note < 40) {
        taux_actuel = 1.85;
    }
    else {
        taux_actuel = 0;
    }

    // Ajout du bonus/malus avec les passagers :
    // Principe de la recherche avec le nombre de passagers et le bonus :
    passagers_bonus_list = [[1, 0.11], [2, -0.17], [3, -0.29], [4, -0.53]];
    for (let x = 0; x < passagers_bonus_list.length; x++) {
        if (passagers_bonus_list[x][0] == passagers) {
            taux_actuel = taux_actuel + passagers_bonus_list[x][1];
        }
    }

    // Retourne le taux :
    return taux_actuel;
}
</script>
</body>
</html>